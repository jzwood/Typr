
<!DOCTYPE html>
<!--
Taken from Mike Bostock tutorial @ http://bl.ocks.org/mbostock/3885304
and modified with inspiration from G3n1K's blog: https://g3n1k.wordpress.com/2014/01/28/bar-chart-complete-code-d3-js/
-->
<html>
<head>
  <style>

  *{
    font-size: 16pt;
    font-family: monospace;
  }

  body{
    background-color: rgb(246, 244, 255);
  }
  h1{
    margin-left: 80px;
    text-align: left;
  }
  .axis {
    font: 10px sans-serif;
  }

  .axis path,
  .axis line {
    fill: none;
    stroke: #000;
    shape-rendering: crispEdges;
  }

  .x.axis path {
    display: none;
  }

  </style>
</head>
<body>
  <h1 id="title"></h1>
  <script type="text/javascript" src="/scripts/d3/d3.min.js" charset="utf-8"></script>
  <!-- <script src="http://ajax.googleapis.com/ajax/libs/jquery/2.1.0/jquery.min.js"></script> -->
  <script>

  var dataURL = window.location.search;
  var re = /%22/g;
  dataURL = dataURL.replace(re,'"').substring(1);
  console.log(dataURL.length);
  var data = eval(dataURL);

  var colors = ["#BDB5FF", "#B9AFFF", "#B6A9FF", "#B2A4FF", "#AF9EFF", "#AB99FF", "#A893FF", "#A48DFF", "#A188FF", "#9D82FF", "#9A7DFF"];

var data1 = [
  {	"k":"A", "m":4, "s":2},
  {	"k":"B", "m":6, "s":2},
  {	"k":"C",	"m":1, "s":0},
  {	"k":"D",	"m":13, "s":1},
  {	"k":"E",	"m":7, "s":5}
];

var margin = {top: 20, right: 20, bottom: 30, left: 60},
width = 960 - margin.left - margin.right,
height = 500 - margin.top - margin.bottom;

var x = d3.scale.ordinal()
.rangeRoundBands([0, width], .1);

var y = d3.scale.linear()
.range([height, 0]);

var xAxis = d3.svg.axis()
.scale(x)
.orient("bottom");

var yAxis = d3.svg.axis()
.scale(y)
.orient("left");

x.domain(data.map(function(d) { return d.k; }));
y.domain([0, d3.max(data, function(d) { return d.s; })]);

var svg = d3.select("body").append("svg")
.attr("width", width + margin.left + margin.right)
.attr("height", height + margin.top + margin.bottom)
.append("g")
.attr("transform", "translate(" + margin.left + "," + margin.top + ")");

svg.append("g")
.attr("class", "x axis")
.attr("transform", "translate(0," + height + ")")
.call(xAxis);

svg.append("g")
.attr("class", "y axis")
.call(yAxis)
// .append("text")
// .attr("transform", "rotate(-90)")
// .attr("y", 6)
// .attr("dy", ".71em")
// .style("text-anchor", "end")
// .text("Number of Mistypes");

svg.selectAll(".bar")
.data(data)
.enter().append("rect")
.attr("class", "bar")
// .style("fill",function(d,i){ return colors[i%colors.length];})
.style("fill",function(d,i){
  var maximum = d3.max(data, function(d) { return d.s; });
  return colors[Math.min(Math.round(d.s/maximum*(colors.length-1)),(colors.length-1))];
})
.attr("x", function(d) { return x(d.k); })
.attr("width", x.rangeBand())
.attr("y", function(d) { return y(d.s); })
.attr("height", function(d) { return height - y(d.s); });
document.getElementById('title').innerHTML = "Number of Times each Letter was Typed Right";

function transPlot(data, plot){
  if(plot === 0){
    document.getElementById('title').innerHTML = "Number of Times each Letter was Typed Wrong";
    x.domain(data.map(function(d) { return d.k; }));
    y.domain([0, d3.max(data, function(d) { return d.m; })]);

    svg.selectAll(".y.axis")
    .call(yAxis);

    svg.selectAll(".x.axis")
    .call(xAxis);

    svg.selectAll(".bar")
    .data(data)
    .transition()
    .duration(1000)
    .ease("linear")
    .style("fill",function(d,i){
      var maximum = d3.max(data, function(d) { return d.m; });
      return colors[Math.min(Math.round(d.m/maximum*(colors.length-1)),(colors.length-1))]; //makes taller more purple
    })
    .attr("x", function(d) { return x(d.k); })
    .attr("width", x.rangeBand())
    .attr("y", function(d) { return y(d.m); })
    .attr("height", function(d) { return height - y(d.m); });
  }else if(plot === 1){
    document.getElementById('title').innerHTML = "Ratio of (Typed Wrong / Letter Encountered) by Letter";
    x.domain(data.map(function(d) { return d.k; }));
    y.domain([0, d3.max(data, function(d) { return d.m/d.s; })]);

    svg.selectAll(".y.axis")
    .call(yAxis);

    svg.selectAll(".x.axis")
    .call(xAxis);

    svg.selectAll(".bar")
    .data(data)
    .transition()
    .duration(1000)
    .ease("linear")
    .style("fill",function(d,i){
      var maximum = d3.max(data, function(d) { return d.m/d.s; });
      return colors[Math.min(Math.round(d.m/d.s/maximum*(colors.length-1)),(colors.length-1))]; //makes taller more purple
    })
    .attr("x", function(d) { return x(d.k); })
    .attr("width", x.rangeBand())
    .attr("y", function(d) { return y(d.m/d.s); })
    .attr("height", function(d) { return height - y(d.m/d.s); });
  }else{
    document.getElementById('title').innerHTML = "Number of Times each Letter was Typed Right";
    x.domain(data.map(function(d) { return d.k; }));
    y.domain([0, d3.max(data, function(d) { return d.s; })]);

    svg.selectAll(".y.axis")
    .call(yAxis);

    svg.selectAll(".x.axis")
    .call(xAxis);

    svg.selectAll(".bar")
    .data(data)
    .transition()
    .duration(1000)
    .ease("linear")
    .style("fill",function(d,i){
      var maximum = d3.max(data, function(d) { return d.s; });
      return colors[Math.min(Math.round(d.s/maximum*(colors.length-1)),(colors.length-1))]; //makes taller more purple
    })
    .attr("x", function(d) { return x(d.k); })
    .attr("width", x.rangeBand())
    .attr("y", function(d) { return y(d.s); })
    .attr("height", function(d) { return height - y(d.s); });
  }
}

var plotNumber = 1;
document.body.onclick = function(){
  transPlot(data,plotNumber);
  plotNumber = (plotNumber + 1) % 3;
}

function type(d) {
  d.s = +d.s;
  return d;
}
</script>
</body>
</html>
